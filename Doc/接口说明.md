# 接口说明

# 目录

- [概述](#概述)
 - [接口基地址](#接口基地址)
 - [JsonResult类型说明](#jsonresult类型说明)
 - [Session类型说明](#session类型说明)
 - [LoginResult枚举值说明](#loginresult枚举值说明)
- [用户数据接口](#数据接口)
 - [用户登录](#用户登录)
 - [用户注销](#用户注销)
 - [修改登录密码](#修改登录密码)
 - [重置登录密码](#重置登录密码)
- [群组](#群组)
 - [新建群组](#新建群组)
 - [SDG_Group类型说明](#sdg_group类型说明)
 - [删除群组](#删除群组)
 - [编辑群组信息](#编辑群组信息)
 - [转让群主](#转让群主)
 - [获取群组信息](#获取群组信息)
 - [Group类型说明](#group类型说明)
 - [获取群组列表](#获取群组列表)
 - [搜索群组](#搜索群组)
 - [加入群组](#加入群组)
 - [开除群组成员](#开除群组成员)
 - [同意加入群组](#同意加入群组)
 - [获取群组成员列表](#获取群组成员列表)
 - [SDG_GroupMember类型说明](#sdg_groupmember类型说明)
- [设置](#设置)
 - [获取话题可用标签](#获取话题可用标签)
 - [MasterData类型说明](#masterdata类型说明)
 - [获取短信验证码](#获取短信验证码)
 - [获取七牛云文件上传Token](#获取七牛云文件上传token)

# 概述

接口访问形式：GET、POST、PUT、DELETE。

除登录外，所有接口都需要验证，验证分两类：

1. 使用Session验证

2. 使用接口传入参数（string、int等简单类型）验证

验证数据由Request的Authorization头部承载。
验证数据的编码方式为Base64。接口的验证数据及参数的传人方式详见《[接口调用示例](https://github.com/limijiaoyin/Super-Dentist/wiki/接口调用示例)》。返回值详见接口说明，错误信息详见《[错误信息表](https://github.com/limijiaoyin/Super-Dentist/wiki/错误信息表)》。  
[回目录](#目录)

## 接口基地址

- BaseService：http://120.27.142.125:6200/
- Interface：http://120.27.142.125:6280/  
[回目录](#目录)

## JsonResult类型说明

|DataTypes|Attribute |Description|
| ------------ | ------------ | ------------ |
|bool|Successful|接口调用是否成功|
|string|Code|错误代码|
|string|Name|错误名|
|string|Message|错误消息，描述了接口调用失败原因|
|string|Data|接口返回数据(Json)|
[回目录](#目录)

## Session类型说明

|DataTypes|Attribute |Description|
| ------------ | ------------ | ------------ |
|int|ID|自增ID，用于下标查找|
|Guid|UserId|用户ID|
|string|UserName|用户名|
|string|OpenId|微信openid|
|string|LoginName|用户账号|
|string|Signature|用户签名|
|Guid|DeptId|用户登录部门ID（App无用）|
|string|DeptName|用户登录部门全称（App无用）|
|int|UserType|用户类型|
|bool|Validity|用户状态：true正常；false封禁|
|string|MachineId|用户设备码|
|int|FailureCount|连续验证失败次数，超过5次封禁1小时|
|DateTime|LastConnect|上次连接时间|
|LoginResult|LoginResult|用户登录/验证结果|
|bool|OnlineStatus|用户是否在线|
[回目录](#目录)

## LoginResult枚举值说明

|Code|Value|Description|
| ------------ | ------------ | ------------ |
|0|Success|登录成功|
|1|Multiple|账号已在其他设备登录|
|2|Online|账号已在此设备登录|
|3|Failure|登录失败(错误的登录密码)|
|4|Banned|账号被禁止登录和使用|
|5|NotExist|账号不存在|
|6|Unauthorized|在线用户已超最大用户数|
[回目录](#目录)

# 数据接口

## 用户

### 用户登录

PUT (BaseService) users/{account}/signin

- 签名：

无

- 参数：Data

|Class|Parameter|Value|
| ------------ | ------------ | ------------ |
|Session|session|new Session|
||||
|string|Session.LoginName|登录账号|
|string|Session.Signature|MD5(登录账号.ToUpper() + MD5(登录密码))|
|string|Session.MachineId|设备ID的MD5值|

- 返回值：

JsonResult：返回值是一个JsonResult对象，指示接口调用成功或失败以及错误信息。

Data(Session)：返回值是一个完成登录的Session对象，需要保存在本地，用于需要使用Session来签名的接口验证。  
[回目录](#目录)

### 用户注销

PUT (BaseService) users/{account}/signout

- 签名：

|Class|Parameter|Value|
| ------------ | ------------ | ------------ |
|Base64|Authorization|Session（返回的Session）|

- 参数：Data

|Class|Parameter|Value|
| ------------ | ------------ | ------------ |
|int| id |Session.ID|

- 返回值：

JsonResult：返回值是一个JsonResult对象，指示接口调用成功或失败以及错误信息。  
[回目录](#目录)

### 修改登录密码

PUT (BaseService) users/{id}/signature

- 签名：

|Class|Parameter|Value|
| ------------ | ------------ | ------------ |
|Base64|Authorization|Session（返回的Session）|

- 参数：Data

|Class|Parameter|Value|
| ------------ | ------------ | ------------ |
|string| password |新密码的MD5值|

- 返回值：

JsonResult：返回值是一个JsonResult对象，指示接口调用成功或失败以及错误信息。  
[回目录](#目录)

### 重置登录密码

PUT (BaseService) users/{account}/resetpw

- 签名：

|Class|Parameter|Value|
| ------------ | ------------ | ------------ |
|Base64|Authorization|new Session|
||||
|string|Session.LoginName|手机号|
|string|Session.Signature|MD5(Mobile + SmsCode + MD5(password))|
|string|Session.MachineId|设备ID的MD5值|

- 参数：Data

|Class|Parameter|Value|
| ------------ | ------------ | ------------ |
|string| smsCode |短信验证码|
|string| password |密码的MD5值|

- 返回值：

JsonResult：返回值是一个JsonResult对象，指示接口调用成功或失败以及错误信息。

Data(Session)：返回值是一个完成登录的Session对象，需要保存在本地，用于需要使用Session来签名的接口验证。  
[回目录](#目录)

## 群组

### 新建群组

POST groups

- 签名：

|Class|Parameter|Value|
| ------------ | ------------ | ------------ |
|Base64|Authorization|Session（返回的Session）|

- 参数：Data

|Class|Parameter|Value|
| ------------ | ------------ | ------------ |
|SDG_Group|group|构造一个SDG_Group类型|

- 返回值：

JsonResult：返回值是一个JsonResult对象，指示接口调用成功或失败以及错误信息。

Data(string)：新增群组的ID  
[回目录](#目录)

#### SDG_Group类型说明

|DataTypes|Attribute |Description|
| ------------ | ------------ | ------------ |
|Guid|ID|ID（唯一标识）|
|long|SN|自增序列|
|string|Name|群组名称|
|string|Description|群组描述|
|string|Icon|群组图标Url|
|string|Picture|群组图片Url|
|int|Heat|群组热度|
|Guid|OwnerUserId|群主的会员ID|
|Guid|ManageUserId|管理员的会员ID|
|bool|Validity|是否有效|
|Guid|CreatorUserId|记录创建用户ID|
|DateTime|CreateTime|记录创建时间|
[回目录](#目录)

### 删除群组

DELETE groups/{id}

- 签名：

|Class|Parameter|Value|
| ------------ | ------------ | ------------ |
|Base64|Authorization|Session（返回的Session）|

- 参数：Data

|Class|Parameter|Value|
| ------------ | ------------ | ------------ |
|string|id|群组ID|

- 返回值：

JsonResult：返回值是一个JsonResult对象，指示接口调用成功或失败以及错误信息。  
[回目录](#目录)

### 编辑群组信息

PUT groups/{id}

- 签名：

|Class|Parameter|Value|
| ------------ | ------------ | ------------ |
|Base64|Authorization|Session（返回的Session）|

- 参数：Data

|Class|Parameter|Value|
| ------------ | ------------ | ------------ |
|SDG_Group|group|SDG_Group|
||||
|string|Name|群组名称|
|string|Description|群组描述|
|string|Icon|群组图标Url|
|string|Picture|群组图片Url|
|Guid|ManageUserId|管理员会员ID|

- 返回值：

JsonResult：返回值是一个JsonResult对象，指示接口调用成功或失败以及错误信息。  
[回目录](#目录)

### 转让群主

PUT groups/{id}/transfer

- 签名：

|Class|Parameter|Value|
| ------------ | ------------ | ------------ |
|Base64|Authorization|Session（返回的Session）|

- 参数：Data

|Class|Parameter|Value|
| ------------ | ------------ | ------------ |
|string|id|群组ID|
|string|mid|新的群主会员ID|

- 返回值：

JsonResult：返回值是一个JsonResult对象，指示接口调用成功或失败以及错误信息。  
[回目录](#目录)

### 获取群组信息

GET groups/{id}

- 签名：

|Class|Parameter|Value|
| ------------ | ------------ | ------------ |
|Base64|Authorization|Session（返回的Session）|

- 参数：Url

|Class|Parameter|Value|
| ------------ | ------------ | ------------ |
|string|id|群组ID|

- 返回值：

JsonResult：返回值是一个JsonResult对象，指示接口调用成功或失败以及错误信息。  
Data(Group集合)：群组信息  
[回目录](#目录)

#### Group类型说明

|DataTypes|Attribute |Description|
| ------------ | ------------ | ------------ |
|Guid|ID|群组D(唯一标识)|
|string|Name|群组名称|
|string|Description|群组描述|
|string|Icon|群组图标Url|
|string|Picture|群组图片Url|
|int|Heat|热度|
|int|Topics|话题数|
|int|Members|成员数|
|int|Favorites|收藏数|
|Guid|OwnerUserId|群主会员ID|
|Guid|ManageUserId|管理员会员ID|
|bool|IsJoin|是否已加入该群组|
|bool|IsCare|是否已收藏该群组|
[回目录](#目录)

### 获取群组列表

GET groups?mid={mid}

- 签名：

|Class|Parameter|Value|
| ------------ | ------------ | ------------ |
|Base64|Authorization|mid + Secret（约定的密钥）|

- 参数：Url

|Class|Parameter|Value|
| ------------ | ------------ | ------------ |
|string|mid|Session.UserId（用户未登录可为空）|

- 返回值：

JsonResult：返回值是一个JsonResult对象，指示接口调用成功或失败以及错误信息。

Data(Group集合)：群组集合  
[回目录](#目录)

### 搜索群组

GET groups/search?keys={keys}&mid={mid}

- 签名：

|Class|Parameter|Value|
| ------------ | ------------ | ------------ |
|Base64|Authorization|keys + Secret（约定的密钥）|

- 参数：Url

|Class|Parameter|Value|
| ------------ | ------------ | ------------ |
|string|keys|关键词|
|string|mid|Session.UserId（用户未登录可为空）|

- 返回值：

JsonResult：返回值是一个JsonResult对象，指示接口调用成功或失败以及错误信息。

Data(Group集合)：群组集合  
[回目录](#目录)

### 加入群组

POST /groups/members

- 签名：

|Class|Parameter|Value|
| ------------ | ------------ | ------------ |
|Base64|Authorization|Session（返回的Session）|

- 参数：Data

|Class|Parameter|Value|
| ------------ | ------------ | ------------ |
|SDG_GroupMember|member|new SDG_GroupMember|
||||
|Guid|GroupId|要加入的群组ID|
|Guid|MemberId|要加入的会员ID|

- 返回值：

JsonResult：返回值是一个JsonResult对象，指示接口调用成功或失败以及错误信息。

Data(string)：群组成员记录ID  
[回目录](#目录)

### 开除群组成员

DELETE /groups/members/{id}

- 签名：

|Class|Parameter|Value|
| ------------ | ------------ | ------------ |
|Base64|Authorization|Session（返回的Session）|

- 参数：Data

|Class|Parameter|Value|
| ------------ | ------------ | ------------ |
|string|id|群组成员数据记录ID|

- 返回值：

JsonResult：返回值是一个JsonResult对象，指示接口调用成功或失败以及错误信息。  
[回目录](#目录)

### 同意加入群组

PUT /groups/members/{id}

- 签名：

|Class|Parameter|Value|
| ------------ | ------------ | ------------ |
|Base64|Authorization|Session（返回的Session）|

- 参数：Data

|Class|Parameter|Value|
| ------------ | ------------ | ------------ |
|string|id|群组成员数据记录ID|

- 返回值：

JsonResult：返回值是一个JsonResult对象，指示接口调用成功或失败以及错误信息。  
[回目录](#目录)

### 获取群组成员列表

GET /groups/{id}/members?type={type}

- 签名：

|Class|Parameter|Value|
| ------------ | ------------ | ------------ |
|Base64|Authorization|Session（返回的Session）|

- 参数：Url

|Class|Parameter|Value|
| ------------ | ------------ | ------------ |
|string|id|群组ID|
|int|type|0为申请加入列表，1为成员列表|

形如：/group/member

- 返回值：

JsonResult：返回值是一个JsonResult对象，指示接口调用成功或失败以及错误信息。

Data(Group集合)：群组集合  
[回目录](#目录)

#### SDG_GroupMember类型说明

|DataTypes|Attribute |Description|
| ------------ | ------------ | ------------ |
|Guid|ID|群组成员ID(唯一标识)|
|long|SN|自增序列|
|Guid|GroupId|群组ID|
|Guid|MemberId|会员ID|
|bool|Validity|是否有效|
|DateTime|CreateTime|记录创建时间|
[回目录](#目录)

## 设置


### 获取话题可用标签

GET setting/tags

- 签名：

|Class|Parameter|Value|
| ------------ | ------------ | ------------ |
|Base64|Authorization|Secret（约定的密钥）|

- 参数：Url

无

- 返回值：

JsonResult：返回值是一个JsonResult对象，指示接口调用成功或失败以及错误信息。

Data(MasterData集合)：主数据（话题标签）集合  
[回目录](#目录)

#### MasterData类型说明

|DataTypes|Attribute |Description|
| ------------ | ------------ | ------------ |
|Guid|ID|主数据ID(唯一标识)|
|long|SN|自增序列|
|Guid|ParentId|父数据ID|
|Guid|CategoryId|分类ID|
|string|Code|编码|
|string|Name|名称|
|string|Alias|别名|
|string|FullName|全名|
[回目录](#目录)

### 获取短信验证码

GET setting/verifycode

- 签名：

|Class|Parameter|Value|
| ------------ | ------------ | ------------ |
|Base64|Authorization|Secret（约定的密钥，暂用）|
|Base64|Authorization|ImageHash（验证图形的MD5值，尚未使用）

- 参数：Url

|Class|Parameter|Value|
| ------------ | ------------ | ------------ |
|string|id|验证图形ID（尚未启用，可传空）|
|int|type|验证码类型：1、注册；2、重置登录密码|
|string|mobile|手机号|

形如：/setting/verifycode?id={id}&type={type}&mobile={mobile}

- 返回值：

JsonResult：返回值是一个JsonResult对象，指示接口调用成功或失败以及错误信息。

Data(string)：短信验证码（正式使用时不再返回此数据）  
[回目录](#目录)

### 获取七牛云文件上传Token

GET setting/qiniutoken

- 签名：

|Class|Parameter|Value|
| ------------ | ------------ | ------------ |
|Base64|Authorization|Secret（约定的密钥，暂用）|

- 参数：

无

- 返回值：

JsonResult：返回值是一个JsonResult对象，指示接口调用成功或失败以及错误信息。

Data(string)：七牛云上传Token  
[回目录](#目录)